{
  "id": "GHSA-6whj-7qmg-86qj",
  "modified": "2026-02-03T03:13:30.809583Z",
  "published": "2026-02-02T17:31:33Z",
  "aliases": [
    "CVE-2025-69207"
  ],
  "summary": "Khoj has an IDOR in Notion OAuth Flow that Enables Index Poisoning",
  "details": "### Summary\nAn IDOR in the Notion OAuth callback allows an attacker to hijack any user's Notion integration by manipulating the state parameter. The callback endpoint accepts any user UUID without verifying the OAuth flow was initiated by that user, allowing attackers to replace victims' Notion configurations with their own, resulting in data poisoning and unauthorized access to the victim's Khoj search index.\n\nThis attack requires knowing the user's UUID which can be leaked through shared conversations where an AI generated image is present.\n\n### Details\nWhen users share conversations which contain AI generated images, the file path for the image is constructed using the user's UUID. Knowing this UUID, an attacker is able to intercept the OAuth callback for Notion and replace the `state` parameter with the other user's UUID and sync notion onto their account.\n\n### PoC\n\nThe vulnerable line of code exists in `src/khoj/routers/notion.py` on the callback endpoint.\n```python\n@notion_router.get(\"/auth/callback\")\nasync def notion_auth_callback(request: Request, background_tasks: BackgroundTasks):\n    code = request.query_params.get(\"code\")\n    state = request.query_params.get(\"state\")  # \u003c-- Attacker controlled\n    if not code or not state:\n        return Response(\"Missing code or state\", status_code=400)\n\n    user: KhojUser = await aget_user_by_uuid(state)  # \u003c-- No verification!\n\n    await NotionConfig.objects.filter(user=user).adelete()  # \u003c-- Deletes victim's config\n    \n    # ... OAuth token exchange ...\n    \n    access_token = final_response.get(\"access_token\")\n    await NotionConfig.objects.acreate(token=access_token, user=user)  # \u003c-- Stores attacker's token\n```\n\nTo exploit is relatively easy. Once we know the victim's UUID, we simply initiate the Notion sync process on our own account and intercept the callback, replacing the `state` parameter with the victim's UUID.\n\n### Impact\nDeletes user's existing Notion sync and replaces it with attacker-controlled Notion. Could allow for index poisoning. I'm not entirely sure what Khoj does with synced files but if it's being passed as context to an LLM then I can imagine there's potential here.",
  "affected": [
    {
      "package": {
        "ecosystem": "PyPI",
        "name": "khoj",
        "purl": "pkg:pypi/khoj"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "0"
            },
            {}
          ]
        }
      ],
      "versions": [
        "1.0",
        "1.16.1.dev15",
        "1.16.1.dev16",
        "1.16.1.dev25",
        "1.16.1.dev26",
        "1.16.1.dev47",
        "1.17.0",
        "1.17.1.dev216",
        "1.17.1.dev217",
        "1.17.1.dev218",
        "1.17.1.dev219",
        "1.17.1.dev220",
        "1.17.1.dev221",
        "1.17.1.dev222",
        "1.17.1.dev223",
        "1.17.1.dev229",
        "1.17.1.dev233",
        "1.20.0",
        "1.20.1.dev1",
        "1.20.1.dev11",
        "1.20.1.dev2",
        "1.20.1.dev3",
        "1.20.1.dev4",
        "1.20.1.dev5",
        "1.20.1.dev6",
        "1.20.2",
        "1.20.2.dev1",
        "1.20.2.dev5",
        "1.20.2.dev6",
        "1.20.2.dev8",
        "1.20.3",
        "1.20.3.dev1",
        "1.20.3.dev10",
        "1.20.3.dev11",
        "1.20.3.dev13",
        "1.20.3.dev14",
        "1.20.3.dev15",
        "1.20.3.dev2",
        "1.20.4",
        "1.20.4.dev1",
        "1.20.4.dev13",
        "1.20.4.dev2",
        "1.20.4.dev5",
        "1.20.4.dev6",
        "1.20.4.dev8",
        "1.20.4.dev9",
        "1.20.5.dev1",
        "1.20.5.dev10",
        "1.20.5.dev15",
        "1.20.5.dev16",
        "1.20.5.dev17",
        "1.20.5.dev18",
        "1.20.5.dev22",
        "1.20.5.dev8",
        "1.21.0",
        "1.21.1",
        "1.21.1.dev1",
        "1.21.1.dev2",
        "1.21.2",
        "1.21.2.dev2",
        "1.21.3",
        "1.21.3.dev5",
        "1.21.3.dev6",
        "1.21.4",
        "1.21.4.dev1",
        "1.21.4.dev4",
        "1.21.4.dev8",
        "1.21.4.dev9",
        "1.21.5",
        "1.21.5.dev1",
        "1.21.5.dev5",
        "1.21.6",
        "1.21.6.dev13",
        "1.21.6.dev14",
        "1.21.6.dev6",
        "1.21.7.dev1",
        "1.21.7.dev4",
        "1.21.7.dev6",
        "1.21.7.dev7",
        "1.21.7.dev9",
        "1.22.0",
        "1.22.1",
        "1.22.1.dev1",
        "1.22.2",
        "1.22.2.dev10",
        "1.22.2.dev11",
        "1.22.2.dev12",
        "1.22.2.dev9",
        "1.22.3",
        "1.22.3.dev5",
        "1.22.3.dev6",
        "1.22.4.dev1",
        "1.22.4.dev12",
        "1.22.4.dev13",
        "1.22.4.dev2",
        "1.22.4.dev6",
        "1.22.4.dev7",
        "1.23.0",
        "1.23.1",
        "1.23.1.dev1",
        "1.23.2",
        "1.23.2.dev1",
        "1.23.2.dev2",
        "1.23.3",
        "1.23.3.dev1",
        "1.23.3.dev18",
        "1.23.3.dev2",
        "1.23.3.dev3",
        "1.23.3.dev4",
        "1.23.3.dev5",
        "1.23.3.dev7",
        "1.23.4.dev1",
        "1.23.4.dev11",
        "1.23.4.dev12",
        "1.23.4.dev2",
        "1.23.4.dev3",
        "1.23.4.dev4",
        "1.23.4.dev7",
        "1.24.0",
        "1.24.1",
        "1.24.1.dev14",
        "1.24.1.dev3",
        "1.24.1.dev4",
        "1.24.1.dev5",
        "1.24.1.dev7",
        "1.24.1.dev8",
        "1.24.1.dev9",
        "1.24.2.dev10",
        "1.24.2.dev14",
        "1.24.2.dev15",
        "1.24.2.dev16",
        "1.24.2.dev19",
        "1.24.2.dev2",
        "1.24.2.dev28",
        "1.24.2.dev3",
        "1.24.2.dev31",
        "1.24.2.dev33",
        "1.24.2.dev34",
        "1.24.2.dev4",
        "1.24.2.dev6",
        "1.24.2.dev7",
        "1.24.2.dev8",
        "1.24.2.dev9",
        "1.25.0",
        "1.25.1.dev1",
        "1.25.1.dev12",
        "1.25.1.dev14",
        "1.25.1.dev19",
        "1.25.1.dev2",
        "1.25.1.dev33",
        "1.25.1.dev34",
        "1.25.1.dev7",
        "1.25.1.dev9",
        "1.26.0",
        "1.26.1",
        "1.26.1.dev1",
        "1.26.1.dev3",
        "1.26.2",
        "1.26.2.dev1",
        "1.26.3",
        "1.26.3.dev1",
        "1.26.3.dev3",
        "1.26.4",
        "1.26.4.dev1",
        "1.26.4.dev2",
        "1.26.5.dev1",
        "1.26.5.dev15",
        "1.26.5.dev16",
        "1.26.5.dev27",
        "1.26.5.dev29",
        "1.26.5.dev32",
        "1.26.5.dev34",
        "1.26.5.dev35",
        "1.26.5.dev37",
        "1.26.5.dev43",
        "1.26.5.dev44",
        "1.27.0",
        "1.27.1",
        "1.27.1.dev1",
        "1.27.2.dev1",
        "1.27.2.dev12",
        "1.27.2.dev13",
        "1.27.2.dev130",
        "1.27.2.dev14",
        "1.27.2.dev15",
        "1.27.2.dev16",
        "1.27.2.dev167",
        "1.27.2.dev18",
        "1.27.2.dev2",
        "1.27.2.dev29",
        "1.28.0",
        "1.28.1",
        "1.28.1.dev1",
        "1.28.2",
        "1.28.2.dev1",
        "1.28.3",
        "1.28.3.dev1",
        "1.28.4.dev1",
        "1.28.4.dev11",
        "1.28.4.dev12",
        "1.28.4.dev13",
        "1.28.4.dev2",
        "1.28.4.dev22",
        "1.28.4.dev23",
        "1.28.4.dev24",
        "1.28.4.dev3",
        "1.28.4.dev7",
        "1.28.4.dev71",
        "1.28.4.dev72",
        "1.28.4.dev76",
        "1.28.4.dev77",
        "1.28.4.dev78",
        "1.28.4.dev79",
        "1.28.4.dev81",
        "1.28.4.dev89",
        "1.28.4.dev90",
        "1.28.4.dev92",
        "1.28.4.dev93",
        "1.28.4.dev94",
        "1.29.0",
        "1.29.1",
        "1.29.1.dev1",
        "1.29.1.dev2",
        "1.29.2.dev1",
        "1.29.2.dev11",
        "1.29.2.dev14",
        "1.29.2.dev22",
        "1.29.2.dev25",
        "1.29.2.dev26",
        "1.29.2.dev33",
        "1.29.2.dev35",
        "1.29.2.dev5",
        "1.29.2.dev9",
        "1.30.0",
        "1.30.1",
        "1.30.1.dev10",
        "1.30.1.dev3",
        "1.30.1.dev7",
        "1.30.1.dev9",
        "1.30.10",
        "1.30.10.dev3",
        "1.30.11.dev13",
        "1.30.11.dev15",
        "1.30.11.dev16",
        "1.30.11.dev3",
        "1.30.11.dev46",
        "1.30.11.dev55",
        "1.30.11.dev56",
        "1.30.11.dev58",
        "1.30.11.dev6",
        "1.30.11.dev61",
        "1.30.11.dev62",
        "1.30.11.dev63",
        "1.30.11.dev64",
        "1.30.11.dev65",
        "1.30.11.dev68",
        "1.30.11.dev69",
        "1.30.11.dev70",
        "1.30.11.dev71",
        "1.30.11.dev73",
        "1.30.2",
        "1.30.2.dev10",
        "1.30.2.dev11",
        "1.30.2.dev15",
        "1.30.2.dev20",
        "1.30.2.dev22",
        "1.30.2.dev23",
        "1.30.2.dev25",
        "1.30.2.dev28",
        "1.30.2.dev3",
        "1.30.2.dev32",
        "1.30.2.dev4",
        "1.30.2.dev9",
        "1.30.3",
        "1.30.4",
        "1.30.5",
        "1.30.6",
        "1.30.7",
        "1.30.7.dev1",
        "1.30.8",
        "1.30.8.dev1",
        "1.30.8.dev13",
        "1.30.8.dev16",
        "1.30.8.dev17",
        "1.30.8.dev20",
        "1.30.8.dev4",
        "1.30.9",
        "1.30.9.dev2",
        "1.31.0",
        "1.31.1.dev1",
        "1.31.1.dev13",
        "1.31.1.dev62",
        "1.31.1.dev9",
        "1.32.0",
        "1.32.1",
        "1.32.2",
        "1.32.2.dev1",
        "1.32.2.dev3",
        "1.32.2.dev4",
        "1.32.2.dev5",
        "1.32.2.dev6",
        "1.32.3.dev10",
        "1.32.3.dev2",
        "1.32.3.dev20",
        "1.32.3.dev23",
        "1.32.3.dev3",
        "1.32.3.dev34",
        "1.32.3.dev5",
        "1.32.3.dev54",
        "1.32.3.dev61",
        "1.32.3.dev62",
        "1.32.3.dev8",
        "1.32.3.dev9",
        "1.33.0",
        "1.33.1",
        "1.33.1.dev14",
        "1.33.1.dev15",
        "1.33.1.dev16",
        "1.33.1.dev17",
        "1.33.1.dev2",
        "1.33.1.dev4",
        "1.33.1.dev5",
        "1.33.1.dev6",
        "1.33.2",
        "1.33.2.dev1",
        "1.33.2.dev2",
        "1.33.3.dev10",
        "1.33.3.dev13",
        "1.33.3.dev14",
        "1.33.3.dev15",
        "1.33.3.dev22",
        "1.33.3.dev25",
        "1.33.3.dev28",
        "1.33.3.dev32",
        "1.33.3.dev35",
        "1.33.3.dev39",
        "1.33.3.dev5",
        "1.33.3.dev51",
        "1.33.3.dev53",
        "1.33.3.dev54",
        "1.33.3.dev7",
        "1.33.3.dev9",
        "1.34.0",
        "1.34.1.dev1",
        "1.34.1.dev14",
        "1.34.1.dev2",
        "1.34.1.dev38",
        "1.34.1.dev41",
        "1.34.1.dev42",
        "1.34.1.dev43",
        "1.34.1.dev5",
        "1.34.1.dev6",
        "1.35.0",
        "1.35.1",
        "1.35.1.dev2",
        "1.35.2",
        "1.35.2.dev1",
        "1.35.3",
        "1.35.3.dev2",
        "1.35.3.dev3",
        "1.35.3.dev6",
        "1.35.3.dev7",
        "1.35.4.dev1",
        "1.35.4.dev2",
        "1.35.4.dev53",
        "1.36.0",
        "1.36.1",
        "1.36.1.dev2",
        "1.36.1.dev3",
        "1.36.2",
        "1.36.2.dev1",
        "1.36.2.dev2",
        "1.36.2.dev3",
        "1.36.3",
        "1.36.3.dev1",
        "1.36.4",
        "1.36.4.dev1",
        "1.36.4.dev2",
        "1.36.4.dev3",
        "1.36.5",
        "1.36.5.dev1",
        "1.36.5.dev2",
        "1.36.5.dev3",
        "1.36.5.dev4",
        "1.36.5.dev5",
        "1.36.6",
        "1.36.6.dev1",
        "1.36.6.dev2",
        "1.36.6.dev3",
        "1.36.6.dev4",
        "1.36.6.dev5",
        "1.36.6.dev7",
        "1.36.6.dev8",
        "1.36.7.dev1",
        "1.36.7.dev18",
        "1.36.7.dev22",
        "1.36.7.dev24",
        "1.36.7.dev25",
        "1.36.7.dev26",
        "1.36.7.dev27",
        "1.36.7.dev29",
        "1.36.7.dev31",
        "1.36.7.dev38",
        "1.36.7.dev42",
        "1.36.7.dev44",
        "1.36.7.dev66",
        "1.36.7.dev7",
        "1.37.0",
        "1.37.1",
        "1.37.1.dev12",
        "1.37.1.dev15",
        "1.37.1.dev6",
        "1.37.2",
        "1.37.3.dev11",
        "1.37.3.dev14",
        "1.37.3.dev15",
        "1.37.3.dev17",
        "1.37.3.dev18",
        "1.37.3.dev19",
        "1.37.3.dev20",
        "1.37.3.dev21",
        "1.37.3.dev5",
        "1.37.3.dev8",
        "1.38.0",
        "1.38.1.dev15",
        "1.38.1.dev18",
        "1.38.1.dev20",
        "1.38.1.dev29",
        "1.38.1.dev3",
        "1.38.1.dev30",
        "1.38.1.dev8",
        "1.38.1.dev9",
        "1.39.0",
        "1.39.1.dev14",
        "1.39.1.dev2",
        "1.39.1.dev22",
        "1.39.1.dev25",
        "1.39.1.dev3",
        "1.39.1.dev4",
        "1.39.1.dev5",
        "1.39.1.dev9",
        "1.40.0",
        "1.40.1.dev1",
        "1.40.1.dev13",
        "1.40.1.dev15",
        "1.40.1.dev18",
        "1.40.1.dev20",
        "1.40.1.dev27",
        "1.40.1.dev28",
        "1.40.1.dev30",
        "1.40.1.dev31",
        "1.41.0",
        "1.41.1.dev107",
        "1.41.1.dev13",
        "1.41.1.dev142",
        "1.41.1.dev144",
        "1.41.1.dev152",
        "1.41.1.dev153",
        "1.41.1.dev155",
        "1.41.1.dev16",
        "1.41.1.dev17",
        "1.41.1.dev23",
        "1.41.1.dev25",
        "1.41.1.dev3",
        "1.41.1.dev34",
        "1.41.1.dev37",
        "1.41.1.dev39",
        "1.41.1.dev4",
        "1.41.1.dev40",
        "1.41.1.dev43",
        "1.41.1.dev90",
        "1.41.1.dev97",
        "1.42.0",
        "1.42.1",
        "1.42.1.dev10",
        "1.42.1.dev8",
        "1.42.10",
        "1.42.10.dev2",
        "1.42.10.dev3",
        "1.42.2",
        "1.42.2.dev1",
        "1.42.2.dev16",
        "1.42.2.dev19",
        "1.42.2.dev23",
        "1.42.3",
        "1.42.3.dev1",
        "1.42.3.dev6",
        "1.42.4",
        "1.42.4.dev1",
        "1.42.5",
        "1.42.5.dev6",
        "1.42.6",
        "1.42.6.dev11",
        "1.42.6.dev13",
        "1.42.6.dev6",
        "1.42.7",
        "1.42.7.dev10",
        "1.42.7.dev11",
        "1.42.7.dev12",
        "1.42.7.dev6",
        "1.42.7.dev7",
        "1.42.8",
        "1.42.8.dev1",
        "1.42.8.dev4",
        "1.42.8.dev6",
        "1.42.9",
        "1.42.9.dev16",
        "1.42.9.dev17",
        "1.42.9.dev23",
        "1.42.9.dev26",
        "1.42.9.dev27",
        "1.42.9.dev4",
        "1.42.9.dev5",
        "2.0.0b1",
        "2.0.0b10",
        "2.0.0b11",
        "2.0.0b11.dev15",
        "2.0.0b11.dev9",
        "2.0.0b12",
        "2.0.0b12.dev5",
        "2.0.0b13",
        "2.0.0b13.dev19",
        "2.0.0b13.dev23",
        "2.0.0b13.dev5",
        "2.0.0b14",
        "2.0.0b14.dev32",
        "2.0.0b14.dev43",
        "2.0.0b14.dev51",
        "2.0.0b14.dev7",
        "2.0.0b14.dev9",
        "2.0.0b15.dev22",
        "2.0.0b15.dev23",
        "2.0.0b15.dev29",
        "2.0.0b16.dev0",
        "2.0.0b16.dev8",
        "2.0.0b17.dev0",
        "2.0.0b17.dev14",
        "2.0.0b18.dev0",
        "2.0.0b18.dev13",
        "2.0.0b18.dev14",
        "2.0.0b19.dev0",
        "2.0.0b19.dev5",
        "2.0.0b19.dev7",
        "2.0.0b2",
        "2.0.0b2.dev3",
        "2.0.0b20.dev0",
        "2.0.0b20.dev6",
        "2.0.0b21.dev0",
        "2.0.0b21.dev2",
        "2.0.0b22.dev0",
        "2.0.0b22.dev6",
        "2.0.0b23",
        "2.0.0b23.dev0",
        "2.0.0b23.dev10",
        "2.0.0b24",
        "2.0.0b24.dev1",
        "2.0.0b24.dev4",
        "2.0.0b25.dev1",
        "2.0.0b25.dev3",
        "2.0.0b3",
        "2.0.0b4",
        "2.0.0b4.dev2",
        "2.0.0b4.dev3",
        "2.0.0b5",
        "2.0.0b5.dev2",
        "2.0.0b6",
        "2.0.0b6.dev6",
        "2.0.0b6.dev7",
        "2.0.0b6.dev8",
        "2.0.0b7",
        "2.0.0b7.dev1",
        "2.0.0b7.dev6",
        "2.0.0b8",
        "2.0.0b8.dev1",
        "2.0.0b8.dev3",
        "2.0.0b9",
        "2.0.0b9.dev11",
        "2.0.0b9.dev7"
      ],
      "database_specific": {
        "source": "https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-6whj-7qmg-86qj/GHSA-6whj-7qmg-86qj.json"
      }
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/khoj-ai/khoj/security/advisories/GHSA-6whj-7qmg-86qj"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/khoj-ai/khoj"
    }
  ]
}