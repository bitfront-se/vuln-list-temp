{
  "Severity": "LOW",
  "UpdatedAt": "2026-02-26T22:15:31Z",
  "Package": {
    "Ecosystem": "PIP",
    "Name": "wger"
  },
  "Advisory": {
    "DatabaseId": 339436,
    "Id": "GSA_kwCzR0hTQS00MmNyLXcyZ3ItbTU0cc4ABS3s",
    "GhsaId": "GHSA-42cr-w2gr-m54q",
    "References": [
      {
        "Url": "https://github.com/wger-project/wger/security/advisories/GHSA-42cr-w2gr-m54q"
      },
      {
        "Url": "https://nvd.nist.gov/vuln/detail/CVE-2026-27838"
      },
      {
        "Url": "https://github.com/wger-project/wger/commit/e964328784e2ee2830a1991d69fadbce86ac9fbf"
      },
      {
        "Url": "https://github.com/advisories/GHSA-42cr-w2gr-m54q"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-42cr-w2gr-m54q"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2026-27838"
      }
    ],
    "Description": "### Summary\n\nFive routine detail action endpoints check a cache before calling `self.get_object()`. Cache keys are scoped only by `pk` — no user ID is included. When a victim has previously accessed their routine via the API, an attacker can retrieve the cached response for the same PK without any ownership check.\n\n### Details\n\n`wger/manager/api/views.py` — five actions follow this pattern (lines 134–201):\n\n```python\n@action(detail=True)\ndef date_sequence_display_mode(self, request, pk=None):\n    cache_key = make_routine_api_date_sequence_display_cache_key(pk)\n    cached = cache.get(cache_key)\n    if cached:\n        return Response(cached)   # returned WITHOUT calling self.get_object()\n    # only reaches ownership check on cache miss\n    routine = self.get_object()\n    ...\n```\n\nCache key construction in `wger/utils/cache.py:89–106`:\n\n```python\ndef make_routine_api_date_sequence_display_cache_key(routine_id):\n    return f\"routine-api-date-sequence-display-{routine_id}\"\n    # No user ID in key\n```\n\nCache TTL: 1 month (`4 * 604800` seconds, `settings_global.py:461`).\n\nAffected endpoints:\n```\nGET /api/v2/routine/{pk}/date-sequence-display/\nGET /api/v2/routine/{pk}/date-sequence-gym/\nGET /api/v2/routine/{pk}/structure/\nGET /api/v2/routine/{pk}/logs/\nGET /api/v2/routine/{pk}/stats/\n```\n\n### PoC\n\n```\n1. Victim (user A) visits GET /api/v2/routine/5/structure/ → response cached under key \"routine-api-structure-5\"\n2. Attacker (user B) visits GET /api/v2/routine/5/structure/ → cache hit → returns user A's routine structure without any ownership check\n```\n\nRequires the victim to have previously accessed the endpoint (cache must be populated). Once populated, the cache entry is valid for 1 month.\n\n### Impact\n\nAn attacker with a registered account can retrieve another user's routine details — workout day sequences, exercise structure, training logs, and statistics — from cache without ownership verification.\n\n**Fix**: Include the user ID in the cache key:\n```python\ndef make_routine_api_date_sequence_display_cache_key(routine_id, user_id):\n    return f\"routine-api-date-sequence-display-{user_id}-{routine_id}\"\n```\n\nOr move `self.get_object()` before the cache lookup so ownership is always verified first.",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2026-02-26T22:15:30Z",
    "Severity": "LOW",
    "Summary": "wger: IDOR via user-unscoped cache keys on routine API actions exposes workout data",
    "UpdatedAt": "2026-02-27T21:59:41Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 3.1,
      "VectorString": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": ""
      },
      "VulnerableVersionRange": "\u003c= 2.1"
    }
  ]
}